<%# encoding: utf-8 %>

<div class="nav">
    <h1 class="pull-left">订单列表</h1>

  <div class="search">
    <%= form_tag(operation_orders_path, class: 'form-inline', method: 'get') do %>
      <%= select_tag "order_status_select", options_for_select([["全部", "all"], ["未支付", "pending"], ["已支付", "paid"], ["已出票", "success"], ["已退款", "refund"], ["已过期", "outdate"]], "#{params[:order_status_select]}"), class: 'form-control' %>
      <%= text_field_tag "q", params[:q],  class: 'form-control', placeholder: "输入演出名称搜索" %>
      <%= submit_tag "搜索", class: 'btn btn-default' %>
    <% end %>
  </div>
</div>

  <hr />

  <% if @orders.any? %>
    <p>
      下载:
      <%= link_to "CSV", operation_orders_path(params.merge(q: params[:q], order_status_select: params[:order_status_select], page: 0, format: "csv")) %> |
      <%= link_to "Excel", operation_orders_path(params.merge(q: params[:q], order_status_select: params[:order_status_select], page: 0, format: "xls")) %>
    </p>
  <% end %>

<div class="orders_list">
  <%= render partial: "table", locals: {orders: @orders} %>
</div>
<div class="nav">
    <h1 class="pull-left">实体票快递详情</h1>
  <div class="search">
    <%= form_tag(operation_orders_path, class: 'form-inline', method: 'get') do %>
      <%= text_field_tag "q_express", params[:q_express],  class: 'form-control', placeholder: "输入收货人信息搜索" %>
      <%= submit_tag "搜索", class: 'btn btn-default' %>
    <% end %>
  </div>
</div>
<div class="expresses_list mt20" id="expresses_list">
  <table class="table table-hover expresses">
    <thead>
      <tr>
        <th>订单号</th>
        <th>收货人姓名</th>
        <th>收货人电话</th>
        <th>收货人地址</th>
        <th>门票状态</th>
        <th>门票类型</th>
        <th>快递单号</th>
        <th>修改</th>
        <th>查看</th>
      </tr>
    </thead>
    <tbody>
      <% @r_ticket_orders.each do |order| %>
        <tr>
          <td><%= order.out_id%></td>
          <td><%= order.user_name  %></td>
          <td><%= order.user_mobile %></td>
          <td width="400px"><%= order.user_address %></td>
          <td><%= order.status_cn %></td>
          <td><%= order.show.try(:ticket_type_cn) %></td>
          <td id="td_express_id_<%= order.id %>"><%= order.express_id%></td>
          <td>
            <button class="btn btn-info change_express_data" data-order-id="<%= order.id %>">修改单号</button>
          </td>
          <td>
            <%= link_to "查看详情", operation_order_path(order) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <%= paginate @r_ticket_orders, param_name: 'r_ticket_orders_page' %>
</div>
