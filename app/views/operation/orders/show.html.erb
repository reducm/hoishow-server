<%# encoding: utf-8 %>

<div class="nav">
  <h1 class="pull-left">订单详情</h1>
  <%= hidden_field_tag "order_id", @order.id %>
</div>
<div>
  <% show = @order.show%>
  <table class="table">
    <tbody>
      <tr><td>订单号</td><td><%= @order.out_id %></td></tr>
      <tr><td>交易单号</td><td><%= @order.out_trade_no %></td></tr>
      <tr><td>订单状态</td><td><%= @order.status_cn %></td></tr>
      <tr><td>下单来源</td><td><%= @order.channel_view %></td></tr>
      <tr><td>下单平台</td><td><%= @order.buy_origin %></td></tr>
      <tr><td>手机号</td><td><%= @order.user_mobile %></td></tr>

      <tr><td>快递收件人</td><td><%= @order.user_name || "电子票无快递信息" %></td></tr>
      <tr><td>快递单号</td><td><%= @order.express_id || "电子票无快递信息" %></td></tr>
      <tr><td>快递地址</td><td><%= @order.user_address || "电子票无快递信息" %></td></tr>
      <tr><td>票数</td><td><%= @order.tickets_count %></td></tr>
      <tr><td>门票类型</td><td><%= show.ticket_type_cn %></td></tr>
      <tr><td>总金额</td><td><%= @order.amount %></td></tr>

      <tr><td>演出名称</td><td><%= @order.show_name %></td></tr>
      <tr><td>演出场馆</td><td><%= @order.stadium_name %></td></tr>
      <tr><td>演出城市</td><td><%= @order.city_name %></td></tr>
      <tr><td>演出时间</td><td><%= @order.show_time_format %></td></tr>

      <tr><td>下单时间</td><td><%= @order.created_at_format %></td></tr>
      <tr><td>付款时间</td><td><%= @order.generate_ticket_at_format %></td></tr>
      <tr><td>退款时间</td><td><%= @order.refund? ? get_datetime(@order.payments.first.refund_at) : "" %></td></tr>
      <tr><td>退款人</td><td><%= @order.refund? ? @order.refund_by : "" %></td></tr>
      <tr>
        <td>备注</td>
        <td>
          <%= form_tag(update_remark_content_operation_order_path(@order), method: :post) do %>
            <div class="form-group">
              <%= text_area_tag "remark", @order.remark, rows: 5, cols: 50 %>
            </div>
            <div class="form-group">
              <%= submit_tag "确认修改备注内容", class: 'btn btn-primary' %>
            </div>
          <% end %>
        </td>
      </tr>
      <% if show.e_ticket? %>
      <tr>
        <td>座位</td>
        <td>
          <table>
            <tr>
              <td>
                <% get_areas(@order).each do |area| %>
                  <% tickets = @order.tickets.where(area_id: area.id) %>
                  <p><%= area.name.upcase + " / " + tickets.count.to_s + "张" %></p>
                  <% tickets.each do |ticket| %>
                    <p><%= ticket.code %></p>
                  <%end%>
                <%end%>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>
