
  <%= form_for [:operation, stadium], class: 'form-horizontal' do |f| %>
    <div class="form-group">
      <%= f.label :name, '场馆名' %>
      <%= f.text_field :name %>
    </div>
    <div class="form-group">
      <%= f.label :address, '场馆地址' %>
      <%= f.text_field :address %>
    </div>
    <div class="form-group">
      <label>场馆坐标</label>
      <%= f.label :longitude, '经度' %>
      <%= f.text_field :longitude %>
      <%= f.label :latitude, '纬度' %>
      <%= f.text_field :latitude %>
    </div>
    <div id="map"></div>
    <div class="form-group">
      <%= f.label :pic, "场馆平面图" %>
      <%= f.file_field :pic %>
    </div>
    <%= f.hidden_field :city_id, value: city.id %>
    <div class="form-group">
      <%= f.submit "提交", class: 'btn btn-primary' %>
    </div>
  <% end %>
  <%= hidden_field_tag 'city_name', city.name %>

  <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=798886ba701989c1cbcf271aaa944ccc"></script>

  <script type="text/javascript">
  function initMap(){
    var map = new AMap.Map('map');
    var marker, position;

    map.setCity($("#city_name").val())

  	map.plugin(["AMap.ToolBar"],function(){
  		toolBar = new AMap.ToolBar();
  		map.addControl(toolBar);
  	});

    function addMarker(){
      marker = new AMap.Marker({
        position: map.getCenter(),
        draggable: true //点标记可拖拽
     	});
     	marker.setMap(map)
    }

    function getMarkerPosition(){
      AMap.event.addListener(marker,'dragend',function(){
        position = marker.getPosition()
        $("#stadium_longitude").val(position.lng)
        $("#stadium_latitude").val(position.lat)
      });
    }

    AMap.event.addListener(map,'complete',function(){
      map.setZoom(14)
      addMarker()
      getMarkerPosition()
    });
  }

  initMap()
  </script>