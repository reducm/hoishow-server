<div class="nav">
  <h2>
    演出详情
    <% if can? :update, @show %>
      <small><%= link_to "编辑", edit_operation_show_path(@show) %></small>
    <% end %>
  </h2>
  <h3><%= @show.name %></h3>
  <table class="table">
    <tbody>
      <tr>
        <td>演出时间</td>
        <td><%= @show.show_time.strfcn_time%></td>
      </tr>
      <tr>
        <td>演出城市</td>
        <td><%= @show.city.name%></td>
      </tr>
      <tr>
        <td>演出场馆</td>
        <td><%= @show.stadium.name %></td>
      </tr>
    </tbody>
  </table>
</div>

<div role="tabpanel">

  <!-- Nav tabs -->
  <ul class="nav nav-pills" role="tablist">
    <li role="presentation" class="active"><a href="#shows_show_orders" aria-controls="shows_show_orders" role="tab" data-toggle="tab">票务</a></li>
    <li role="presentation"><a href="#shows_show_topics" aria-controls="shows_show_topics" role="tab" data-toggle="tab">互动</a></li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="shows_show_orders">
      <div id="pie_cake" >
        <% @show.areas.each do |area| %>
          <% tickets = @show.tickets.where(area_id: area.id) %>
          <% total_count = tickets.count%>
          <% sold_tickets_count = tickets.sold_tickets.count %>
          <div class="pull-left" total_tickets=<%= total_count.to_s%> sold_count=<%= sold_tickets_count.to_s %> left_count= <%= (total_count - sold_tickets_count).to_s %> id=<%= area.name %> style="height:300px; width:300px"></div>
        <% end %>
      </div>
      <%= render partial: 'operation/orders/table', locals: {orders: @show.orders} %>
    </div>

    <div role="tabpanel" class="tab-pane" id="shows_show_topics">
      <%= render partial: 'operation/topics/table', locals: {topics: @show.topics} %>
    </div>

  </div>
</div>
